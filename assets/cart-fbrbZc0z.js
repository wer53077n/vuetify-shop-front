import{_ as S,a5 as B,u as A,E as y,c as h,a as p,b as s,w as a,o as _,ad as l,R as i,a8 as f,av as k,aA as N,ax as P,ay as R,az as $}from"./index-CMThWAey.js";import{V as j}from"./VContainer-DkrkuJpx.js";import{a as m,V as D}from"./VRow-BbOHvp1r.js";import{V as E}from"./VSheet-DzVw2Y0r.js";import{V as T}from"./VDataTable-B3yVoDtP.js";import"./VPagination-CwcVEbZ-.js";import"./VSelect-CbcKIANz.js";import"./VList-CN1Cl8Z4.js";import"./VDivider-v-MMDXrU.js";import"./VMenu-CES0RCwf.js";const z=r=>(R("data-v-aa20f96a"),r=r(),$(),r),U={class:"background"},F=z(()=>k("h1",{class:"text-center pa-5"},"購物車",-1)),G={key:0},H={key:1,class:"text-red"},J={class:"pa-5"},K={__name:"cart",setup(r){const{apiAuth:C}=N(),V=P(),d=B(),v=A(),o=y([]),g=[{title:"品名",key:"p_id.name"},{title:"單價",key:"p_id.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:t=>t.p_id.price*t.quantity},{title:"操作",key:"action"}];(async()=>{var t,c;try{const{data:e}=await C.get("/user/cart");o.value=e.result}catch(e){console.log(e),d({text:((c=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:c.message)||"發生錯誤",snackbarProps:{color:"red"}})}})();const b=h(()=>o.value.reduce((t,c)=>t+c.quantity*c.p_id.price,0)),q=h(()=>o.value.length>0&&!o.value.some(t=>!t.p_id.sell)),x=y(!1),w=async()=>{x.value=!0;const t=await v.checkout();d({text:t.text,snackbarProps:{color:t.color}}),t.color==="green"&&V.push("/orders"),x.value=!1},u=async(t,c)=>{const e=await v.addCart(t,c);if(d({text:e.text,snackbarProps:{color:e.color}}),e.color==="green"){const n=o.value.findIndex(I=>I.p_id._id===t);o.value[n].quantity+=c,o.value[n].quantity<=0&&o.value.splice(n,1)}};return(t,c)=>(_(),p("div",U,[s(j,null,{default:a(()=>[s(m,{cols:"12"},{default:a(()=>[F]),_:1}),s(E,{rounded:""},{default:a(()=>[s(D,{justify:"center",align:"center",class:"text-center"},{default:a(()=>[s(m,{cols:"12",class:"d-flex justify-center pa-10 text-center"},{default:a(()=>[s(T,{items:o.value,headers:g,class:"text-center"},{"item.p_id.name":a(({item:e})=>[e.p_id.sell?(_(),p("span",G,l(e.p_id.name),1)):(_(),p("span",H,l(e.p_id.name)+" (已下架)",1))]),"item.quantity":a(({item:e})=>[s(i,{variant:"text",color:"red",onClick:n=>u(e.p_id._id,-1)},{default:a(()=>[f("-")]),_:2},1032,["onClick"]),k("span",null,l(e.quantity),1),s(i,{variant:"text",color:"green",onClick:n=>u(e.p_id._id,1)},{default:a(()=>[f("+")]),_:2},1032,["onClick"])]),"item.action":a(({item:e})=>[s(i,{variant:"text",color:"red",icon:"mdi-delete",onClick:n=>u(e.p_id._id,e.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1})]),_:1})]),_:1}),s(m,{cols:"12",class:"text-center"},{default:a(()=>[k("p",J,"總金額: "+l(b.value),1),s(i,{color:"green",disabled:!q.value,onClick:w},{default:a(()=>[f("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1})]))}},se=S(K,[["__scopeId","data-v-aa20f96a"]]);export{se as default};
