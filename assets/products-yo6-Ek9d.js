import{p as de,aA as ve,aB as ge,g as ie,L as be,aC as fe,aD as Ve,c as O,h as ce,aE as ye,aF as ee,b as o,O as L,t as T,as as ke,A as Pe,F as ae,_ as xe,a5 as Se,E as p,r as he,o as te,a as De,w as i,ac as we,az as Ce,R as _,a8 as q,aG as j,aH as Te,V as Be,a6 as Ie,a7 as Fe,aI as Ae,d as n,ab as Ue,a9 as Re,ad as $e,aa as Me,aJ as Ee,a3 as Ge,ax as He,ay as Le,av as Ne}from"./index--XPUSPIb.js";import{c as _e,a as K,b as qe,d as Oe,u as ze,e as H}from"./vee-validate.esm-QLslr8Pr.js";import{b as le}from"./route-block-B_A1xBdJ.js";import{V as je}from"./VContainer-CdHJ3EUV.js";import{V as Ke,a as J}from"./VRow-Ce4UQWLF.js";import{m as Je,a as We,b as Qe,c as Xe,d as Ye,e as Ze,f as ea,u as aa,p as ta,g as la,h as oa,i as sa,j as ra,k as ua,l as na,n as oe,o as se,q as re,r as ue}from"./VDataTable-Chm1no52.js";import{V as da}from"./VDivider-B45mVl06.js";import{V as ia}from"./VForm-BnMqxBIp.js";import{m as ca,V as ne,a as ma}from"./VSelect-D17XbrD0.js";import{V as pa}from"./VTextarea-BZtYRAV6.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VPagination-CVESvkfM.js";import"./VList-Du9aPcEO.js";import"./VMenu-CTxXa79u.js";const va=de({...ve(),...ge(ca(),["inline"])},"VCheckbox"),ga=ie()({name:"VCheckbox",inheritAttrs:!1,props:va(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,x){let{attrs:S,slots:l}=x;const s=be(e,"modelValue"),{isFocused:v,focus:B,blur:I}=fe(e),V=Ve(),h=O(()=>e.id||`checkbox-${V}`);return ce(()=>{const[D,F]=ye(S),y=ee.filterProps(e),c=ne.filterProps(e);return o(ee,L({class:["v-checkbox",e.class]},D,y,{modelValue:s.value,"onUpdate:modelValue":m=>s.value=m,id:h.value,focused:v.value,style:e.style}),{...l,default:m=>{let{id:k,messagesId:P,isDisabled:g,isReadonly:A,isValid:$}=m;return o(ne,L(c,{id:k.value,"aria-describedby":P.value,disabled:g.value,readonly:A.value},F,{error:$.value===!1,modelValue:s.value,"onUpdate:modelValue":w=>s.value=w,onFocus:B,onBlur:I}),l)}})}),{}}}),ba=de({itemsLength:{type:[Number,String],required:!0},...Je(),...We(),...Qe()},"VDataTableServer"),fa=ie()({name:"VDataTableServer",props:ba(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,x){let{attrs:S,slots:l}=x;const{groupBy:s}=Xe(e),{sortBy:v,multiSort:B,mustSort:I}=Ye(e),{page:V,itemsPerPage:h}=Ze(e),D=O(()=>parseInt(e.itemsLength,10)),{columns:F,headers:y}=ea(e,{groupBy:s,showSelect:T(e,"showSelect"),showExpand:T(e,"showExpand")}),{items:c}=aa(e,F),{toggleSort:m}=ta({sortBy:v,multiSort:B,mustSort:I,page:V}),{opened:k,isGroupOpen:P,toggleGroup:g,extractRows:A}=la({groupBy:s,sortBy:v}),{pageCount:$,setItemsPerPage:w}=oa({page:V,itemsPerPage:h,itemsLength:D}),{flatItems:C}=sa(c,s,k),{isSelected:U,select:M,selectAll:z,toggleSelect:E,someSelected:N,allSelected:R}=ra(e,{allItems:c,currentPage:c}),{isExpanded:b,toggleExpand:r}=ua(e),a=O(()=>A(c.value));na({page:V,itemsPerPage:h,sortBy:v,groupBy:s,search:T(e,"search")}),ke("v-data-table",{toggleSort:m,sortBy:v}),Pe({VDataTableRows:{hideNoData:T(e,"hideNoData"),noDataText:T(e,"noDataText"),loading:T(e,"loading"),loadingText:T(e,"loadingText")}});const d=O(()=>({page:V.value,itemsPerPage:h.value,sortBy:v.value,pageCount:$.value,toggleSort:m,setItemsPerPage:w,someSelected:N.value,allSelected:R.value,isSelected:U,select:M,selectAll:z,toggleSelect:E,isExpanded:b,toggleExpand:r,isGroupOpen:P,toggleGroup:g,items:a.value.map(t=>t.raw),internalItems:a.value,groupedItems:C.value,columns:F.value,headers:y.value}));ce(()=>{const t=oe.filterProps(e),u=se.filterProps(e),f=re.filterProps(e),pe=ue.filterProps(e);return o(ue,L({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},pe),{top:()=>{var G;return(G=l.top)==null?void 0:G.call(l,d.value)},default:()=>{var G,W,Q,X,Y,Z;return l.default?l.default(d.value):o(ae,null,[(G=l.colgroup)==null?void 0:G.call(l,d.value),!e.hideDefaultHeader&&o("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[o(se,L(u,{sticky:e.fixedHeader}),l)]),(W=l.thead)==null?void 0:W.call(l,d.value),!e.hideDefaultBody&&o("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(Q=l["body.prepend"])==null?void 0:Q.call(l,d.value),l.body?l.body(d.value):o(re,L(S,f,{items:C.value}),l),(X=l["body.append"])==null?void 0:X.call(l,d.value)]),(Y=l.tbody)==null?void 0:Y.call(l,d.value),(Z=l.tfoot)==null?void 0:Z.call(l,d.value)])},bottom:()=>l.bottom?l.bottom(d.value):!e.hideDefaultFooter&&o(ae,null,[o(da,null,null),o(oe,t,{prepend:l["footer.prepend"]})])})})}}),Va=e=>(He("data-v-8b812f85"),e=e(),Le(),e),ya={class:"background"},ka=Va(()=>Ne("h1",{class:"text-center"},"商品管理",-1)),me={__name:"products",setup(e){const{apiAuth:x}=Ce(),S=Se(),l=p(null),s=p({open:!1,id:""}),v=r=>{r?(s.value.id=r._id,y.value.value=r.name,c.value.value=r.price,m.value.value=r.description,k.value.value=r.category,P.value.value=r.sell):s.value.id="",s.value.open=!0},B=()=>{s.value.open=!1,F(),l.value.deleteFileRecord()},I=["衣服","手機","遊戲","食品"],V=_e({name:K().required("商品名稱必填"),price:qe().typeError("商品價格格式錯誤").required("商品價格必填").min(0,"商品價格不能小於 0"),description:K().required("商品說明必填"),category:K().required("商品分類必填").test("isCategory","商品分類錯誤",r=>I.includes(r)),sell:Oe()}),{handleSubmit:h,isSubmitting:D,resetForm:F}=ze({validationSchema:V,initialValues:{name:"",price:0,description:"",category:"",sell:!0}}),y=H("name"),c=H("price"),m=H("description"),k=H("category"),P=H("sell"),g=p([]),A=p([]),$=h(async r=>{var a,d,t;if(!((a=g.value[0])!=null&&a.error)&&!(s.value.id.length===0&&g.value.length<1))try{const u=new FormData;u.append("name",r.name),u.append("price",r.price),u.append("description",r.description),u.append("category",r.category),u.append("sell",r.sell),g.value.length>0&&u.append("image",g.value[0].file),s.value.id===""?await x.post("/product",u):await x.patch("/product/"+s.value.id,u),S({text:s.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"green"}}),B(),b(!0)}catch(u){console.log(u),S({text:((t=(d=u==null?void 0:u.response)==null?void 0:d.data)==null?void 0:t.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),w=p(10),C=p([{key:"createdAt",order:"desc"}]),U=p(1),M=p([]),z=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"action"}],E=p(!0),N=p(0),R=p(""),b=async r=>{var a,d,t,u;r&&(U.value=1),E.value=!0;try{const{data:f}=await x.get("/product/all",{params:{page:U.value,itemsPerPage:w.value,sortBy:((a=C.value[0])==null?void 0:a.key)||"createdAt",sortOrder:((d=C.value[0])==null?void 0:d.order)||"desc",search:R.value}});M.value.splice(0,M.value.length,...f.result.data),N.value=f.result.total}catch(f){console.log(f),S({text:((u=(t=f==null?void 0:f.response)==null?void 0:t.data)==null?void 0:u.message)||"發生錯誤",snackbarProps:{color:"red"}})}E.value=!1};return b(),(r,a)=>{const d=he("vue-file-agent");return te(),De("div",ya,[o(je,null,{default:i(()=>[o(Ke,null,{default:i(()=>[o(J,{cols:"12"},{default:i(()=>[ka]),_:1}),o(J,{cols:"10"},{default:i(()=>[o(_,{color:"green",onClick:a[0]||(a[0]=t=>v(null))},{default:i(()=>[q("新增商品")]),_:1})]),_:1}),o(J,{cols:"10",class:"text-center"},{default:i(()=>[o(fa,{"items-per-page":w.value,"onUpdate:itemsPerPage":[a[4]||(a[4]=t=>w.value=t),a[7]||(a[7]=t=>b(!1))],"sort-by":C.value,"onUpdate:sortBy":[a[5]||(a[5]=t=>C.value=t),a[8]||(a[8]=t=>b(!1))],page:U.value,"onUpdate:page":[a[6]||(a[6]=t=>U.value=t),a[9]||(a[9]=t=>b(!1))],items:M.value,headers:z,loading:E.value,"items-length":N.value,search:R.value,hover:""},{top:i(()=>[o(j,{label:"搜尋",modelValue:R.value,"onUpdate:modelValue":a[1]||(a[1]=t=>R.value=t),"append-icon":"mdi-magnify",onClickAppend:a[2]||(a[2]=t=>b(!0)),onKeydown:a[3]||(a[3]=Te(t=>b(!0),["enter"]))},null,8,["modelValue"])]),"item.image":i(({value:t})=>[o(Be,{src:t,height:"50px"},null,8,["src"])]),"item.sell":i(({value:t})=>[t?(te(),Ie(Ge,{key:0,icon:"mdi-check"})):Fe("",!0)]),"item.action":i(({item:t})=>[o(_,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:u=>v(t)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),o(we,{modelValue:s.value.open,"onUpdate:modelValue":a[17]||(a[17]=t=>s.value.open=t),persistent:"",width:"500"},{default:i(()=>[o(ia,{onSubmit:Ae(n($),["prevent"]),disabled:n(D)},{default:i(()=>[o(Ue,null,{default:i(()=>[o(Re,null,{default:i(()=>[q($e(s.value.id?"編輯商品":"新增商品"),1)]),_:1}),o(Me,null,{default:i(()=>[o(j,{label:"名稱",modelValue:n(y).value.value,"onUpdate:modelValue":a[10]||(a[10]=t=>n(y).value.value=t),"error-messages":n(y).errorMessage.value},null,8,["modelValue","error-messages"]),o(j,{label:"價格",type:"number",min:"0",modelValue:n(c).value.value,"onUpdate:modelValue":a[11]||(a[11]=t=>n(c).value.value=t),"error-messages":n(c).errorMessage.value},null,8,["modelValue","error-messages"]),o(ma,{label:"分類",items:I,modelValue:n(k).value.value,"onUpdate:modelValue":a[12]||(a[12]=t=>n(k).value.value=t),"error-messages":n(k).errorMessage.value},null,8,["modelValue","error-messages"]),o(ga,{label:"上架",modelValue:n(P).value.value,"onUpdate:modelValue":a[13]||(a[13]=t=>n(P).value.value=t),"error-messages":n(P).errorMessage.value},null,8,["modelValue","error-messages"]),o(pa,{label:"說明",modelValue:n(m).value.value,"onUpdate:modelValue":a[14]||(a[14]=t=>n(m).value.value=t),"error-messages":n(m).errorMessage.value},null,8,["modelValue","error-messages"]),o(d,{modelValue:g.value,"onUpdate:modelValue":a[15]||(a[15]=t=>g.value=t),"raw-model-value":A.value,"onUpdate:rawModelValue":a[16]||(a[16]=t=>A.value=t),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡呦","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:l},null,8,["modelValue","raw-model-value"])]),_:1}),o(Ee,null,{default:i(()=>[o(_,{color:"red",loading:n(D),onClick:B},{default:i(()=>[q("取消")]),_:1},8,["loading"]),o(_,{color:"green",type:"submit",loading:n(D)},{default:i(()=>[q("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])])}}};typeof le=="function"&&le(me);const $a=xe(me,[["__scopeId","data-v-8b812f85"]]);export{$a as default};
