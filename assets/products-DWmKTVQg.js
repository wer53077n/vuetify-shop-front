import{p as de,aA as ve,aB as pe,g as ie,L as ge,aC as be,aD as fe,c as z,h as me,aE as Ve,aF as ae,b as o,O as L,t as T,as as ye,A as Pe,F as Q,a5 as ke,E as v,r as xe,a as Se,w as i,ac as he,az as De,o as te,R as q,a8 as O,aG as K,aH as we,V as Ce,a6 as Te,a7 as Be,aI as Fe,d as n,ab as Ie,a9 as Ae,ad as Ue,aa as Re,aw as $e,av as Me,a2 as Ee}from"./index-B6C-OAFi.js";import{c as Ge,a as W,b as He,d as Le,u as Ne,e as H}from"./vee-validate.esm-BTG1ocXg.js";import{b as le}from"./route-block-B_A1xBdJ.js";import{V as qe,a as J}from"./VCol-BUbm-Whd.js";import{V as Oe}from"./VRow--ZGpWkJM.js";import{m as ze,a as je,b as Ke,c as We,d as Je,e as Qe,f as Xe,u as Ye,p as Ze,g as _e,h as ea,i as aa,j as ta,k as la,l as oa,n as oe,o as se,q as re,r as ue}from"./VDataTable-DLlpEYJz.js";import{V as sa}from"./VDivider-DT69kc00.js";import{V as ra}from"./VForm-Q1p4M4qT.js";import{m as ua,V as ne,a as na}from"./VSelect-sJ6sUrcF.js";import{V as da}from"./VTextarea-h3Lf4N-k.js";import"./VPagination-CQEdmQZg.js";import"./VList-BCYrwt2R.js";const ia=de({...ve(),...pe(ua(),["inline"])},"VCheckbox"),ma=ie()({name:"VCheckbox",inheritAttrs:!1,props:ia(),emits:{"update:modelValue":t=>!0,"update:focused":t=>!0},setup(t,x){let{attrs:S,slots:l}=x;const s=ge(t,"modelValue"),{isFocused:p,focus:B,blur:F}=be(t),V=fe(),h=z(()=>t.id||`checkbox-${V}`);return me(()=>{const[D,I]=Ve(S),y=ae.filterProps(t),m=ne.filterProps(t);return o(ae,L({class:["v-checkbox",t.class]},D,y,{modelValue:s.value,"onUpdate:modelValue":c=>s.value=c,id:h.value,focused:p.value,style:t.style}),{...l,default:c=>{let{id:P,messagesId:k,isDisabled:g,isReadonly:A,isValid:$}=c;return o(ne,L(m,{id:P.value,"aria-describedby":k.value,disabled:g.value,readonly:A.value},I,{error:$.value===!1,modelValue:s.value,"onUpdate:modelValue":w=>s.value=w,onFocus:B,onBlur:F}),l)}})}),{}}}),ca=de({itemsLength:{type:[Number,String],required:!0},...ze(),...je(),...Ke()},"VDataTableServer"),va=ie()({name:"VDataTableServer",props:ca(),emits:{"update:modelValue":t=>!0,"update:page":t=>!0,"update:itemsPerPage":t=>!0,"update:sortBy":t=>!0,"update:options":t=>!0,"update:expanded":t=>!0,"update:groupBy":t=>!0},setup(t,x){let{attrs:S,slots:l}=x;const{groupBy:s}=We(t),{sortBy:p,multiSort:B,mustSort:F}=Je(t),{page:V,itemsPerPage:h}=Qe(t),D=z(()=>parseInt(t.itemsLength,10)),{columns:I,headers:y}=Xe(t,{groupBy:s,showSelect:T(t,"showSelect"),showExpand:T(t,"showExpand")}),{items:m}=Ye(t,I),{toggleSort:c}=Ze({sortBy:p,multiSort:B,mustSort:F,page:V}),{opened:P,isGroupOpen:k,toggleGroup:g,extractRows:A}=_e({groupBy:s,sortBy:p}),{pageCount:$,setItemsPerPage:w}=ea({page:V,itemsPerPage:h,itemsLength:D}),{flatItems:C}=aa(m,s,P),{isSelected:U,select:M,selectAll:j,toggleSelect:E,someSelected:N,allSelected:R}=ta(t,{allItems:m,currentPage:m}),{isExpanded:b,toggleExpand:r}=la(t),e=z(()=>A(m.value));oa({page:V,itemsPerPage:h,sortBy:p,groupBy:s,search:T(t,"search")}),ye("v-data-table",{toggleSort:c,sortBy:p}),Pe({VDataTableRows:{hideNoData:T(t,"hideNoData"),noDataText:T(t,"noDataText"),loading:T(t,"loading"),loadingText:T(t,"loadingText")}});const d=z(()=>({page:V.value,itemsPerPage:h.value,sortBy:p.value,pageCount:$.value,toggleSort:c,setItemsPerPage:w,someSelected:N.value,allSelected:R.value,isSelected:U,select:M,selectAll:j,toggleSelect:E,isExpanded:b,toggleExpand:r,isGroupOpen:k,toggleGroup:g,items:e.value.map(a=>a.raw),internalItems:e.value,groupedItems:C.value,columns:I.value,headers:y.value}));me(()=>{const a=oe.filterProps(t),u=se.filterProps(t),f=re.filterProps(t),ce=ue.filterProps(t);return o(ue,L({class:["v-data-table",{"v-data-table--loading":t.loading},t.class],style:t.style},ce),{top:()=>{var G;return(G=l.top)==null?void 0:G.call(l,d.value)},default:()=>{var G,X,Y,Z,_,ee;return l.default?l.default(d.value):o(Q,null,[(G=l.colgroup)==null?void 0:G.call(l,d.value),!t.hideDefaultHeader&&o("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[o(se,L(u,{sticky:t.fixedHeader}),l)]),(X=l.thead)==null?void 0:X.call(l,d.value),!t.hideDefaultBody&&o("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(Y=l["body.prepend"])==null?void 0:Y.call(l,d.value),l.body?l.body(d.value):o(re,L(S,f,{items:C.value}),l),(Z=l["body.append"])==null?void 0:Z.call(l,d.value)]),(_=l.tbody)==null?void 0:_.call(l,d.value),(ee=l.tfoot)==null?void 0:ee.call(l,d.value)])},bottom:()=>l.bottom?l.bottom(d.value):!t.hideDefaultFooter&&o(Q,null,[o(sa,null,null),o(oe,a,{prepend:l["footer.prepend"]})])})})}}),pa=Me("h1",{class:"text-center"},"商品管理",-1),ga={__name:"products",setup(t){const{apiAuth:x}=De(),S=ke(),l=v(null),s=v({open:!1,id:""}),p=r=>{r?(s.value.id=r._id,y.value.value=r.name,m.value.value=r.price,c.value.value=r.description,P.value.value=r.category,k.value.value=r.sell):s.value.id="",s.value.open=!0},B=()=>{s.value.open=!1,I(),l.value.deleteFileRecord()},F=["衣服","手機","遊戲","食品"],V=Ge({name:W().required("商品名稱必填"),price:He().typeError("商品價格格式錯誤").required("商品價格必填").min(0,"商品價格不能小於 0"),description:W().required("商品說明必填"),category:W().required("商品分類必填").test("isCategory","商品分類錯誤",r=>F.includes(r)),sell:Le()}),{handleSubmit:h,isSubmitting:D,resetForm:I}=Ne({validationSchema:V,initialValues:{name:"",price:0,description:"",category:"",sell:!0}}),y=H("name"),m=H("price"),c=H("description"),P=H("category"),k=H("sell"),g=v([]),A=v([]),$=h(async r=>{var e,d,a;if(!((e=g.value[0])!=null&&e.error)&&!(s.value.id.length===0&&g.value.length<1))try{const u=new FormData;u.append("name",r.name),u.append("price",r.price),u.append("description",r.description),u.append("category",r.category),u.append("sell",r.sell),g.value.length>0&&u.append("image",g.value[0].file),s.value.id===""?await x.post("/product",u):await x.patch("/product/"+s.value.id,u),S({text:s.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"green"}}),B(),b(!0)}catch(u){console.log(u),S({text:((a=(d=u==null?void 0:u.response)==null?void 0:d.data)==null?void 0:a.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),w=v(10),C=v([{key:"createdAt",order:"desc"}]),U=v(1),M=v([]),j=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"操作",align:"center",sortable:!1,key:"action"}],E=v(!0),N=v(0),R=v(""),b=async r=>{var e,d,a,u;r&&(U.value=1),E.value=!0;try{const{data:f}=await x.get("/product/all",{params:{page:U.value,itemsPerPage:w.value,sortBy:((e=C.value[0])==null?void 0:e.key)||"createdAt",sortOrder:((d=C.value[0])==null?void 0:d.order)||"desc",search:R.value}});M.value.splice(0,M.value.length,...f.result.data),N.value=f.result.total}catch(f){console.log(f),S({text:((u=(a=f==null?void 0:f.response)==null?void 0:a.data)==null?void 0:u.message)||"發生錯誤",snackbarProps:{color:"red"}})}E.value=!1};return b(),(r,e)=>{const d=xe("vue-file-agent");return te(),Se(Q,null,[o(qe,null,{default:i(()=>[o(Oe,null,{default:i(()=>[o(J,{cols:"12"},{default:i(()=>[pa]),_:1}),o(J,{cols:"12"},{default:i(()=>[o(q,{color:"green",onClick:e[0]||(e[0]=a=>p(null))},{default:i(()=>[O("新增商品")]),_:1})]),_:1}),o(J,{cols:"12"},{default:i(()=>[o(va,{"items-per-page":w.value,"onUpdate:itemsPerPage":[e[4]||(e[4]=a=>w.value=a),e[7]||(e[7]=a=>b(!1))],"sort-by":C.value,"onUpdate:sortBy":[e[5]||(e[5]=a=>C.value=a),e[8]||(e[8]=a=>b(!1))],page:U.value,"onUpdate:page":[e[6]||(e[6]=a=>U.value=a),e[9]||(e[9]=a=>b(!1))],items:M.value,headers:j,loading:E.value,"items-length":N.value,search:R.value,hover:""},{top:i(()=>[o(K,{label:"搜尋",modelValue:R.value,"onUpdate:modelValue":e[1]||(e[1]=a=>R.value=a),"append-icon":"mdi-magnify",onClickAppend:e[2]||(e[2]=a=>b(!0)),onKeydown:e[3]||(e[3]=we(a=>b(!0),["enter"]))},null,8,["modelValue"])]),"item.image":i(({value:a})=>[o(Ce,{src:a,height:"50px"},null,8,["src"])]),"item.sell":i(({value:a})=>[a?(te(),Te(Ee,{key:0,icon:"mdi-check"})):Be("",!0)]),"item.action":i(({item:a})=>[o(q,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:u=>p(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),o(he,{modelValue:s.value.open,"onUpdate:modelValue":e[17]||(e[17]=a=>s.value.open=a),persistent:"",width:"500"},{default:i(()=>[o(ra,{onSubmit:Fe(n($),["prevent"]),disabled:n(D)},{default:i(()=>[o(Ie,null,{default:i(()=>[o(Ae,null,{default:i(()=>[O(Ue(s.value.id?"編輯商品":"新增商品"),1)]),_:1}),o(Re,null,{default:i(()=>[o(K,{label:"名稱",modelValue:n(y).value.value,"onUpdate:modelValue":e[10]||(e[10]=a=>n(y).value.value=a),"error-messages":n(y).errorMessage.value},null,8,["modelValue","error-messages"]),o(K,{label:"價格",type:"number",min:"0",modelValue:n(m).value.value,"onUpdate:modelValue":e[11]||(e[11]=a=>n(m).value.value=a),"error-messages":n(m).errorMessage.value},null,8,["modelValue","error-messages"]),o(na,{label:"分類",items:F,modelValue:n(P).value.value,"onUpdate:modelValue":e[12]||(e[12]=a=>n(P).value.value=a),"error-messages":n(P).errorMessage.value},null,8,["modelValue","error-messages"]),o(ma,{label:"上架",modelValue:n(k).value.value,"onUpdate:modelValue":e[13]||(e[13]=a=>n(k).value.value=a),"error-messages":n(k).errorMessage.value},null,8,["modelValue","error-messages"]),o(da,{label:"說明",modelValue:n(c).value.value,"onUpdate:modelValue":e[14]||(e[14]=a=>n(c).value.value=a),"error-messages":n(c).errorMessage.value},null,8,["modelValue","error-messages"]),o(d,{modelValue:g.value,"onUpdate:modelValue":e[15]||(e[15]=a=>g.value=a),"raw-model-value":A.value,"onUpdate:rawModelValue":e[16]||(e[16]=a=>A.value=a),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:l},null,8,["modelValue","raw-model-value"])]),_:1}),o($e,null,{default:i(()=>[o(q,{color:"red",loading:n(D),onClick:B},{default:i(()=>[O("取消")]),_:1},8,["loading"]),o(q,{color:"green",type:"submit",loading:n(D)},{default:i(()=>[O("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])],64)}}};typeof le=="function"&&le(ga);export{ga as default};
